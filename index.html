<!DOCTYPE html>
<html>
<head>
    <!--
    ~   ************************************************************************
    ~            ™T©ReMeTaL Properties: Copyright (c) 2024 ™T©ReMeTaL.
    ~   ************************************************************************
    ~    MIT License
    ~    ™T©ReMeTaL toremetal.com
    ~    Copyright (C) 2024 ™T©ReMeTaL.
    ~
    ~    Permission is hereby granted, free of charge, to any person obtaining a copy
    ~    of this software and associated documentation files (the "Software"), to deal
    ~    in the Software without restriction, including without limitation the rights
    ~    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    ~    copies of the Software, and to permit persons to whom the Software is
    ~    furnished to do so, subject to the following conditions:
    ~
    ~    The above copyright notice and this permission notice shall be included in all
    ~    copies or substantial portions of the Software.
    ~
    ~    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    ~    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    ~    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    ~    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    ~    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    ~    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    ~    SOFTWARE.
    ~    Created with best intent, Use at your own risk.
    ~    ™T©ReMeTaL Assumes No Liability of any kind.
    ~
    ~   ************************************************************************
    -->
    <meta http-equiv="language" content="en_US">
    <meta lang="en_US" />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.1, maximum-scale=2.0, user-scalable=1, shrink-to-fit=yes" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <meta name="copyright" content="&#8482;T&#169;ReMeTaL" />
    <meta name="author" content="&#8482;T&#169;ReMeTaL" />
    <meta name="Description" content="95 OBD 1.5 Scanner">
    <title>OBD 1.5 Scanner - &#8482;T&#169;ReMeTaL</title>
    <link rel="icon" href="img/favicon.png" type="image/png" />
    <link rel="icon" href="img/favicon.ico" type="image/x-icon" />
    <link href="font/obdscanner.css" rel="stylesheet" />
    <script src="ds/ECM278.js"></script>
    <script src="ds/ECM221.js"></script>
    <script src="ds/ECM_CLASSES.js"></script>
    <script>
       const ECM_MAN = new ECM_CLASSES();
       const ecmOptions= ECM_MAN.ecmOptions();
        var ECM = ECM_MAN.setECM("ECM278");/* 3.4L V6 */

        function setECM(file) {
            ECM = ECM_MAN.setECM(file);
            generateUI();
            setEcmValues();
            alert(ECM.toString());
        }
        
        function generateUI() {
            let retStr="";
            let i = 0;
            var tStr = "";
            for(let eId in ECM.ENGINE_DATA) {
                let id = ECM.ENGINE_DATA[eId];
                let title = id;
                if (id != "airfuel" && id != "mph" && id != "rpm" && id != "battery" && id != "gear" && id != "milcodes" && id != "actcodes" && id != "NotUsed" && id != ECM.ENGINE_DATA.length) {
                    if (id == "trans-temp") { tStr = "°f";}
                    else if (id.includes("-mseconds")) { tStr = "ms"; title = id.replace("-mseconds","");}
                    else if (id.includes("-cell")) { tStr = "cell"; title = id.replace("-cell","");}
                    else if (id.includes("-pos")) { tStr = "position"; title = id.replace("-pos","");}
                    else if (id.includes("-psi")) { tStr = "psi"; title = id.replace("-psi","");}
                    else if (id.includes("-int")) { tStr = "int"; title = id.replace("-int","");}
                    else if (id.includes("-blm")) { tStr = "blm"; title = id.replace("-blm","");}
                    else if (id.includes("-rpm")) { tStr = "rpm"; title = id.replace("-rpm","");}
                    else if (id.includes("-volts")) { tStr = "volts"; title = id.replace("-volts","");}
                    else if (id.includes("-percent")) { tStr = "%"; title = id.replace("-percent","");}
                    else if (id.includes("-deg")) { tStr = "°deg"; title = id.replace("-deg","");}
                    else if (id.includes("-msb")) { tStr = "msb"; title = id.replace("-msb","");}
                    else if (id.includes("-lsb")) { tStr = "lsb"; title = id.replace("-lsb","");}
                    else if (id.includes("-celcius")) { tStr = "°C"; title = id.replace("-celcius","");}
                    else if (id.includes("-tempf")) { tStr = "°f"; title = id.replace("-tempf","");}
                    else { tStr = ""; }
                    if (i == 0) {
                        retStr += `<tr>`;
                    }
                    retStr += `<td `;
                    if (id == "trans-temp") {
                        retStr += `hidden id="autoTranTemp" `;
                    }
                    retStr += `class="chromeBorder" width="22%" onclick='sH("${id}Field")'>
                                        <div align="center">
                                            <table border="1" cellpadding="0" bgcolor="#efefef" bordercolor="#c0c0c0"
                                                   bordercolordark="#808080" bordercolorlight="#ffffff">
                                                <tr>
                                                    <td id="${id}Field" onclick='sH("${id}Field")' class="guage">
                                                        <fieldset align="center" class="hide">
                                                            <legend onclick='sH("${id}Field")'>${title}</legend>
                                                            <form align="center">
                                                                <input id="${id}" name="${id}" value="0" type="number"
                                                                       style="margin-top:10px;margin-bottom:10px;"
                                                                       readonly><br /><b style="margin-bottom:-50px;">${tStr}</b>
                                                            </form>`;
                    if (id == "blm-cell") {
                        retStr += `<button title="Reset BLM" onclick="sendEcmCmd(ECM.EcmCmdNums.ResetBLM);" id="resetBlmBtn" class="btn resBtn" disabled>Reset BLM Value</button>`;
                    }
                                                retStr += `</fieldset>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </td>`;
                    i++;
                    if (i == 4) {
                        retStr += `</tr>`;
                        i=0;
                    }
                }
            }
            if (i < 4 && i > 0) {
                retStr += `</tr>`;
            }
            document.getElementById("dynamic-gauges").innerHTML=retStr;
        }

    </script>
    <script>const APPVERSION = '24.11.4.18';</script>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8927593002808864" crossorigin="anonymous"></script>
    
</head>
<body>
    <!--onload="checkCookie()"-->
    <div align="center">
        <header>
            <i style="position:absolute;top:4px;right:4px;z-index:1;">
                <img title="&#8482;T&#169;ReMeTaL" alt="&#8482;T&#169;ReMeTaL" src="img/toremetal.png"
                     style="width:108px;height:74px;border-radius:25%;" />
                <br />
                <a href="https://toremetal.com" target="_blank">&#8482;T&#169;ReMeTaL</a>
            </i>
            <fieldset class="scanControl">

                <div hidden id="wait" class="wait" align="center">-Connecting to ECM-<br />Please Wait</div>
                <legend class="btn" onclick='sH("usbHelp")' title="Click for Connection Diagram">[?]Scan Controls</legend>
                <img onclick='sH("usbHelp")' title="1995 Camaro" alt="1995 Camaro" src="img/camaro2.png"
                     style="cursor:pointer;margin-right:-108px;float:left;border:none;height:48px;width:100px;" />
                
                <input title="Disconnect" style="margin-left:-210px;cursor:pointer;" id="disconnect" value="DisConnect"
                       type="button" onclick="disconnectECM();" disabled />
                <input id="connected" type="checkbox" disabled />
                <input title="Connect to Ecm" style="cursor:pointer;" id="connect" value="Connect to ECM" type="button"
                       onclick="if ('serial' in navigator) {getSerialPortInfo();} else {alert('OBD-1.5 SCANNER:\r\nSupport for Serial Web API not enabled.\r\nPlease enable it using chrome://flags/ and enable Experimental Web Platform features');}" />
                <fieldset style="border-radius:10px;width:fit-content;display:inline-flex;float:left;margin:12px 0 0 140px;background-color:#18c7f245;padding-left:8px;padding-right:8px;">
                    <legend style="background:transparent;background-color:#18c7f225;padding:0;margin:0;border:none;color:lime;cursor:default;">
                        Scans
                    </legend>

                    <input style="cursor:pointer;" disabled type="radio" id="Mode1"
                           onclick="cmdRunning(1);CMD_CONTROL.nextCmd=ECM.EcmCmdNums.engineDataCmdNum;sendEcmCmd(ECM.EcmCmdNums.stopComCmdNum);"
                           name="idle" value="Mode1" title="Request Engine Data">
                    <label for="Mode1">ENG</label>

                    <input style="cursor:pointer;" disabled type="radio" id="Mode2"
                           onclick="cmdRunning(1);CMD_CONTROL.nextCmd=ECM.EcmCmdNums.milDataCmdNum;sendEcmCmd(ECM.EcmCmdNums.stopComCmdNum);"
                           name="idle" value="Mode2" title="Request MIL Codes.">
                    <label for="Mode2">MIL</label>
                    <input style="cursor:pointer;" disabled type="radio" id="Mode4"
                           onclick="cmdRunning(1);CMD_CONTROL.nextCmd=ECM.EcmCmdNums.vinDataCmdNum;sendEcmCmd(ECM.EcmCmdNums.stopComCmdNum);"
                           name="idle" value="Mode4" title="Update VIN Data">
                    <label id="Mode4Label" for="Mode4">VIN</label>
                </fieldset>
                <input title="Continiously Request Engine Data" id="scan" value="Rpt" type="button"
                       onclick='startStopRealTime()' style="cursor:pointer;" disabled />
                <select id="ecmfile" style="cursor:pointer;width:100px;" name="ECM FILE" onchange='setECM(this.value);'>
                    <script>document.write(ecmOptions);</script></select>
                [<sub>
                    <input id="sendingEcmCmd" type="checkbox" style="max-width:4px;" />
                    <label for="sendingEcmCmd">TxRx</label>
                </sub>
                <style>
                    .status {
                        background-color: #00000000;
                        border: 1px ridge #111111;
                        border-radius: 50%;
                        width: 8px;
                        line-height: 0;
                        height: 4px;
                        font-size: 6px;
                    }
                </style>
                <i id="serialStatus" class="status">&nbsp; &nbsp;&nbsp;</i> ]
                <div>
                <select style="cursor:pointer;display:inline-flex;" name="transmissionType" id="transmissionType" onchange='setTransType(!ECM.A_TRANSMISSION);'>
                    <optgroup label="Shift-Type">
                        <option value="false">Manual</option>
                    </optgroup>
                    <optgroup label="Shift-Type">
                        <option value="true">Automatic</option>
                    </optgroup>
                </select>
                    <code id="autoF" class="slidecontainer" hidden>
                        <label for="gear">Automatic- </label>
                        <input type="range" min="0" max="6" value="6" class="slider2" name="prndl" id="gear">
                        [ <span id="prndlDis" style="color:red;font-size:large;">P</span><small style="color:orange;" id="prndlDis2"></small> ]
                    </code>
                <em id="carVin" style="font-size: large; margin: 0 4px -2px 2px; padding: 0 0 10px;width:fit-content;display:inline-flex;float:left;"></em>
                
                    
                </div>
                
            </fieldset>
            <div hidden id="usbHelp"
                 style="opacity: 0.7;position:fixed;top:0;bottom:0;right:0;left:0;height:fit-content;width:fit-content;margin:8px auto 0;z-index:1;background:transparent;background-color:#000000;

            border-radius: 18px;
            border: ridge 0.4px #cbc9c9;
            box-sizing: border-box;
            box-shadow: 1px 2px 5px rgba(0, 0, 0, .31);
            /*border: 1px solid rgb(177, 176, 176);
            border: inset 10px #57F2FF;
            border-style: groove ridge ridge groove;
            border-style: outset inset inset outset;*/"
                 align="center" class="chromeBorder">
                <fieldset>
                    <legend style="min-width:664px;color:orangered;background-color:#000000;width:fit-content;border-radius:15px 15px 1px 1px;cursor:default;"
                            title="Connection Diagram.">
                        <b title="Close." onclick='sH("usbHelp")' style="cursor:pointer;color:black;float:left;background-color:white;border:1px ridge red;border-radius:4px;padding:4px 4px 0;">X</b>
                        <input type="button" id="fs" value="F Screen" style="cursor:pointer;float:right;margin-left:-100px;width:100px;" onclick="getFScreen()" />
                        <label style="margin-left:-30px;">
                            PC-USB to OBD1.5 ECM<br />(with OBD2 plug) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </label>
                        <br />
                        <img style="margin-bottom:-20px;" id="usbImage" title="USB" alt="USB" src="img/usb.png" />
                        <br />
                        <i style="color:skyblue;margin-bottom:-20px;">Rx/Tx to Pin <sup style="color:blue;font-size:xx-large;"><sub>9</sub></sup><small><sup><sub style="color:grey;">( M on 12 pin-dlc )</sub></sup></small>.</i>
                        <br />
                        <i style="color:yellow;margin-bottom:-20px;">Gnd to Pins <sup style="color:goldenrod;font-size:larger;">4</sup> <small>&</small> <sup style="font-size:larger;color:gold;">5<small><sub style="color:grey;font-size:small;">( A on 12 pin-dlc )</sub></small></sup>.</i>
                    </legend>
                </fieldset>
                <fieldset>
                    <legend style="min-width:664px;color:orangered;background-color:#000000;width:fit-content;border-radius:1px;padding:4px 4px;cursor:default;"
                            title="Scan Settings">
                        <i title="Un-Check if Not Receiving Engine Data.">Verify Engine Data</i>
                        <input id="validate" style="border-radius:10px;cursor:pointer;" title="Not-Compatible with all OS's." type="checkbox" />
                        |<i title="Check to Disable ECM(Eng) to ECM(ABS,Trans,etc.) Messaging.">Disable ECM Messages</i>
                        <input id="msg" style="border-radius:10px;cursor:pointer;" title="Check to Disable ECM(Eng) to ECM(ABS,Trans,etc.) Messaging while Scanning." type="checkbox" />
                    </legend>
                </fieldset>
                <fieldset>
                    <legend style="min-width:664px;color:orangered;background-color:#000000;width:fit-content;border-radius:1px;padding-top:10px;cursor:default;">
                        <i title="Retry Interval." style="margin-bottom:-4px;">Retry at,</i>
                        <input id="delayTime" style="border-radius:10px;width:100px;margin-bottom:-4px;" title="Retry delay."
                               value="9" type="number" min="1" max="100" step="1"
                               onchange='CMD_CONTROL.delayTime=parseInt(this.value);' /> Reads
                        <i title="Retry Interval." style="margin-bottom:-4px;">or </i>
                        <input id="delayBytes" style="border-radius:10px;width:100px;margin-bottom:-4px;" title="Retry delay."
                               value="255" type="number" min="76" max="1024" step="1"
                               onchange='CMD_CONTROL.delayBytes=parseInt(this.value);' /> Bytes

                        <i title="Cache Size." style="margin-bottom:-4px;">Flush at</i>
                        <input id="cacheSize" style="border-radius:10px;width:100px;margin-bottom:-4px;"
                               title="Cache Size." value="510" type="number" min="76"
                               max="1024" step="16" onchange='CMD_CONTROL.cacheSize=parseInt(this.value);' /> bytes
                    </legend>
                </fieldset>
                <fieldset>
                    <legend style="min-width:664px;color:orangered;background-color:#000000;width:fit-content;border-radius:1px;padding-top:10px;cursor:default;">
                        <i title="Send Cmd Interval." style="margin-bottom:-4px;">Send Cmd's every</i>
                        <input id="loopTimeValue" style="border-radius:10px;width:100px;margin-bottom:-4px;"
                               title="Send Interval. IMPORTANT!! Set BEFORE Connecting!" value="64" type="number" min="64"
                               max="10240" step="64" onchange='CMD_CONTROL.loopTime=parseInt(this.value);' /> ms
                        <i title="Com Port buffer." style="margin-bottom:-4px;">Buffer Size</i>
                        <input id="bufferSize" style="border-radius:10px;width:100px;margin-bottom:-4px;" title="COM-Port buffer. IMPORTANT!! Set BEFORE Connecting!"
                               value="77" type="number" min="75" max="1024" step="1"
                               onchange='CMD_CONTROL.bufferSize=parseInt(this.value);' /> Bytes
                        <br />
                        <code title="IMPORTANT!! Make these adjustments BEFORE Connecting!" style="color:orange;font-size:small;">IMPORTANT!! Set these BEFORE Connecting! [1 sec = 1000 ms]</code>
                    </legend>
                </fieldset>
                <fieldset>
                    <legend style="min-width:664px;color:orangered;background-color:#000000;width:fit-content;border-radius:1px 1px 15px 15px;cursor:default;"
                            title="Data Cmd's">
                        <code style="color:orange;font-size:small;">
                            <small style="color:skyblue;" title="CAUTION!! Modifying Cmd Bytes may prevent ECM from responding!"><i style="color:lime;">CAUTION!!</i> Modifying Cmd Bytes may prevent ECM from responding!</small><br />
                            <i title="Connect to ECM">[Connect]</i>
                            <input id="s0" style="border-radius:10px;width:40px;" title="Connect" maxlength="4" onchange="ECM.EcmCmds.stopComCmd=createCmd('com');" value="0xE4" />
                            <input id="s1" style="border-radius:10px;width:40px;" title="Connect" maxlength="4" onchange="ECM.EcmCmds.stopComCmd=createCmd('com');" value="0x56" />
                            <input id="s2" style="border-radius:10px;width:40px;" title="Connect" maxlength="4" onchange="ECM.EcmCmds.stopComCmd=createCmd('com');" value="0x08" />
                            <input id="s3" style="border-radius:10px;width:40px;" title="Connect" maxlength="4" onchange="ECM.EcmCmds.stopComCmd=createCmd('com');" value="0xAE" />
                            <br />
                            <i title="Engine Data Request">[Engine Data]</i>
                            <input id="e0" style="border-radius:10px;width:40px;" title="Engine Data" maxlength="4" onchange="ECM.EcmCmds.engineDataCmd=createCmd('eng');" value="0xE4" />
                            <input id="e1" style="border-radius:10px;width:40px;" title="Engine Data" maxlength="4" onchange="ECM.EcmCmds.engineDataCmd=createCmd('eng');" value="0x57" />
                            <input id="e2" style="border-radius:10px;width:40px;" title="Engine Data" maxlength="4" onchange="ECM.EcmCmds.engineDataCmd=createCmd('eng');" value="0x01" />
                            <input id="e3" style="border-radius:10px;width:40px;" title="Engine Data" maxlength="4" onchange="ECM.EcmCmds.engineDataCmd=createCmd('eng');" value="0x00" />
                            <input id="e4" style="border-radius:10px;width:40px;" title="Engine Data" maxlength="4" onchange="ECM.EcmCmds.engineDataCmd=createCmd('eng');" value="0xC4" />
                            <br />
                        </code>
                    </legend>
                </fieldset>
            </div>
        </header>
        <input id="NotUsed" type="text" value="" hidden />
        <input id="toDo" type="text" value="" hidden />
        <div align="center">
            <button title="Main Data" onclick='selectTab("MainTab")'
                    style="cursor:pointer;border-radius:45%;border-end-start-radius:2px;border-end-end-radius:2px;padding:2px 6px;">
                DASH
            </button>
            <button title="View Engine Data" onclick='selectTab("engTab")'
                    style="cursor:pointer;border-radius:45%;border-end-start-radius:2px;border-end-end-radius:2px;padding:2px 6px;">
                Engine
            </button>
            <button id="tranTabBtn" title="View Transmission Data" onclick='selectTab("TransTab")'
                    style="cursor:pointer;border-radius:45%;border-end-start-radius:2px;border-end-end-radius:2px;padding:2px 6px;">
                Auto-Transmission
            </button>
            <button title="View MIL/DTC Codes" onclick='selectTab("MilTab")'
                    style="cursor:pointer;border-radius:45%;border-end-start-radius:2px;border-end-end-radius:2px;padding:2px 6px;">
                MIL-Codes
            </button>
            <button title="Send Commands to the ECM" onclick='selectTab("ActTab")'
                    style="cursor:pointer;border-radius:45%;border-end-start-radius:2px;border-end-end-radius:2px;padding:2px 6px;">
                Actuators
            </button>
            <button title="Raw Serial Data" onclick='selectTab("ScanTab")'
                    style="cursor:pointer;border-radius:45%;border-end-start-radius:2px;border-end-end-radius:2px;padding:2px 6px;">
                Serial
            </button>
            <!-- Dash -->
            <div id="MainTab" align="center">
                <div id="Dash">
                    <fieldset style="border:none;">
                        <legend class="tab btn" style="width:fit-content;margin:auto;cursor:default;" id="dashTitle">
                            <!-- onclick='sH("Dash")' <b>Dash</b>&nbsp;-->
                            <i class="chromeBorder" title="Engine Fan Status"
                               style='cursor:default;border:1px solid;border-radius:10%;padding:2px;'>
                                <img onclick="document.getElementById('fanOnOff').click();" title="Engine Fan Status" alt="Fan" src="img/fan.png"
                                     style="cursor: pointer;background: transparent; width: 32px; height: 32px; border-radius: 6px; padding: 0; margin: -10px 0 -12px;" />
                                <label title="Engine Fan Switch" class="switch" style="transform:scale(0.6);margin:0 0 0 0;width:60px;" for="fanOnOff">
                                    <input style="margin:0 0 0 0;" title="Engine Fan Switch" id="fanOnOff" type="checkbox" onclick="if(this.checked){sendEcmCmd(ECM.EcmCmdNums.fanon);}else{sendEcmCmd(ECM.EcmCmdNums.fanoff);}">
                                    <span class="slider round"></span>
                                </label>
                            </i>
                            &nbsp;
                            <i class="chromeBorder" title="EGR Valve Status: Green-Open, Red-Closed"
                               style='cursor:default;border:1px solid;border-radius:10%;'>
                                egr
                                <sup style="cursor:pointer"
                                     onClick='if(getComputedStyle(egrOne).backgroundColor=="rgb(255, 0, 0)"){sendEcmCmd(ECM.EcmCmdNums.egr1on);egrStatus(0, "green");}else{sendEcmCmd(ECM.EcmCmdNums.egr1off);egrStatus(0, "red");}'>
                                    1
                                    <sub id='egr1' class="status">&nbsp; &nbsp;&nbsp;</sub>
                                </sup>
                                <sup style="cursor:pointer"
                                     onClick='if(getComputedStyle(egrTwo).backgroundColor=="rgb(255, 0, 0)"){sendEcmCmd(ECM.EcmCmdNums.egr2on);egrStatus(1, "green");}else{sendEcmCmd(ECM.EcmCmdNums.egr2off);egrStatus(1, "red");}'>2<sub id='egr2' class="status">&nbsp; &nbsp;&nbsp;</sub></sup>
                                <sup style="cursor:pointer"
                                     onClick='if(getComputedStyle(egrThree).backgroundColor=="rgb(255, 0, 0)"){sendEcmCmd(ECM.EcmCmdNums.egr3on);egrStatus(2, "green");}else{sendEcmCmd(ECM.EcmCmdNums.egr3off);egrStatus(2, "red");}'>3<sub id='egr3' class="status">&nbsp; &nbsp;&nbsp;</sub></sup>
                            </i>
                            &nbsp;
                            <i id="clutchdiv" class="chromeBorder" title="Clutch Status"
                               style='cursor:default;border:1px solid;border-radius:10%;padding:2px;'>
                                <img id="clutchImg" title="Clutch Status" alt="Clutch" src="img/clutch.png"
                                     style="background:transparent;width:32px;height:32px;border-radius:6px;padding:0;margin:-10px 0 -12px;" />
                                <label title="Clutch Status" class="switch"
                                       style="transform:scale(0.6);margin:0 0 0 0;width:60px;" for="clutchpressed">
                                    <input onchange="if(this.checked){document.getElementById('clutchImg').style.transform = 'rotateZ(35deg)'} else {document.getElementById('clutchImg').style.transform = 'rotateZ(0deg)'}"
                                           style="margin:0 0 0 0;" title="Clutch Status" id="clutchpressed" type="checkbox" disabled>
                                    <span class="slider round" style="cursor:default;"></span>
                                </label>
                            </i>
                            <i id="tcc" class="chromeBorder" title="TCC Brake"
                               style='cursor:default;border:1px solid;border-radius:10%;padding:2px;'>
                                tcc brake
                                <label title="TCC Brake" class="switch"
                                       style="transform:scale(0.6);margin:0 0 0 0;width:60px;" for="brakepressed">
                                    <input style="margin:0 0 0 0;" title="TCC Brake" id="brakepressed" type="checkbox" disabled>
                                    <span class="slider round" style="cursor:default;"></span>
                                </label>
                            </i>
                            &nbsp;
                            <i class="chromeBorder" title="DTC Count"
                               style='cursor:default;border:1px solid;border-radius:10%;padding-top:4px;'>
                                <sup style="width:fit-content;">
                                    <img id="checkEngineLight" title="History DTC count" alt="checkEngineLight" src="img/checkEngine.png"
                                         style="background:transparent;width:40px;height:24px;border-radius:6px;padding:0;margin:0 0 -12px;" />
                                    <label for="actcodes" title="History DTC's" hidden>History</label>
                                    <sub hidden>
                                        <input type="number" title="History DTC count" step="1" id="actcodes" name="historymilcodes" value="0"
                                               style="cursor:default;font-size:16px;width:40px;margin-bottom:-16px;" readonly>
                                    </sub>
                                    <sub>
                                        <input type="number" title="Active DTC's" step="1" id="milcodes" name="milcodes" value="0"
                                               style="cursor:default;font-size:16px;width:40px;margin-bottom:-16px;" readonly>
                                    </sub>
                                </sup>
                            </i>
                        </legend>
                    </fieldset>
                    <div class="td1 tab" style="padding: 0; border-radius: 7%;">
                        <div class="td2" align="center">
                            <table class="td1">
                                <!--(1) set of 3-->
                                <tr>
                                    <td class="chromeBorder" width="22%" onclick='sH("f1")'>
                                        <div align="center">
                                            <table border="1" cellpadding="0" bgcolor="#efefef" bordercolor="#c0c0c0"
                                                   bordercolordark="#808080" bordercolorlight="#ffffff">
                                                <tr>
                                                    <td id="f1" onclick='sH("f1")' class="guage">
                                                        <fieldset align="center" class="hide">
                                                            <legend onclick='sH("f1")' style="background:transparent;">
                                                                Air/Fuel
                                                            </legend>
                                                            <form align="center"
                                                                  style="width:200px;height:inherit;padding:0 0 0 0;margin:-8px auto 0;">
                                                                <input type="number" step="0.1" id="airfuel"
                                                                       name="airfuel" value="14.7"
                                                                       style="border-radius:50%;font-size:xx-large;width:100px;padding:10px 0 20px 10px;"
                                                                       readonly>
                                                            </form>
                                                        </fieldset>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </td>
                                    <!--item (2)-->
                                    <td onclick='sH("rpmField")' class="hide">
                                        <div align="center">
                                            <table border="1" cellpadding="0" bgcolor="transparent"
                                                   bordercolor="#c0c0c0" bordercolordark="#808080"
                                                   bordercolorlight="#ffffff">
                                                <tr>
                                                    <td onclick='sH("rpmField")'>
                                                        <fieldset id="rpmField" align="center" class="chromeBorder"
                                                                  style="background-image: url('img/rpm-guage.png');background-repeat: no-repeat;width:200px;height:200px;padding:8px;">
                                                            <legend onclick='sH("rpmField")'>RPM</legend>
                                                            <form align="center"
                                                                  style="width:inherit;height:inherit;margin:auto;">
                                                                <img id="rpm-needle" src="img/rpm-needle.png"
                                                                     style="width:inherit;height:inherit;margin:-26px 0 0 -18px;" /><br />
                                                                <input type="number" onchange="rotateRPM()" id="rpm"
                                                                       name="rpm" value="0"
                                                                       style="font-size:12px;width:100px;border-radius:10px;margin:-42px 0 0 -59px;position:absolute;">
                                                                <!-- readonly-->
                                                                <fieldset hidden
                                                                          style="padding:0;margin:0;font-size:12px;border-radius: 6px;border: solid 0.4px #cbc9c9;text-shadow: 1px 2px 5px rgba(0,0,0,0.31);background: transparent;cursor: default;box-shadow: none;">
                                                                    <legend style="padding:0;margin:0;text-align:left;color:darkblue;font-size:12px;text-shadow: 1px 2px 5px rgba(0,0,0,0.31);border-radius: 0;border: none;background: transparent;cursor: default;box-shadow: none;">
                                                                        24x
                                                                    </legend>
                                                                    <input type="number" id="rpm24x" name="rpm24x"
                                                                           value="0" readonly>
                                                                </fieldset>
                                                            </form>
                                                        </fieldset>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </td>
                                    <!--end item (2)-->
                                    <!--item (3)-->
                                    <td onclick='sH("mphField")' class="hide">
                                        <div align="center">
                                            <table border="1" cellpadding="0" bgcolor="transparent"
                                                   bordercolor="#c0c0c0" bordercolordark="#808080"
                                                   bordercolorlight="#ffffff">
                                                <tr>
                                                    <td onclick='sH("mphField")'>
                                                        <fieldset id="mphField" align="center" class="chromeBorder"
                                                                  style="background-image: url('img/mph-guage.png');background-repeat: no-repeat;width:200px;height:200px;padding:8px;">
                                                            <legend onclick='sH("mphField")'>MPH</legend>
                                                            <form align="center"
                                                                  style="width:inherit;height:inherit;padding:0;margin:auto;">
                                                                <img id="mph-needle" src="img/mph-needle.png"
                                                                     style="width:inherit;height:inherit;margin:-26px 0 0 -14px;" /><br />
                                                                <input type="number" onchange="rotateMPH()" id="mph"
                                                                       name="mph" value="0"
                                                                       style="font-size:12px;width:100px;border-radius:10px;margin:-42px 0 0 -59px;position:absolute;">
                                                            </form>
                                                        </fieldset>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </td>
                                    <!--end item (3)-->
                                    <!-- item [BATTERY] -->
                                    <td class="chromeBorder" width="22%" onclick='sH("fc")'>
                                        <div align="center">
                                            <table border="1" cellpadding="0" bgcolor="#efefef" bordercolor="#c0c0c0"
                                                   bordercolordark="#808080" bordercolorlight="#ffffff">
                                                <tr>
                                                    <td id="fc" onclick='sH("fc")'
                                                        style="background-image: url('img/bat-guage.png');background-repeat: no-repeat;width:200px;height:200px;padding:0;">
                                                        <fieldset align="center" class="hide">
                                                            <legend onclick='sH("fc")'>Battery +</legend>
                                                            <form align="center">
                                                                <input style="border-radius:6px;margin-top:2px;margin-bottom:30px;"
                                                                       type="number" step="0.1" id="battery" name="battery"
                                                                       value="12.9" readonly>
                                                            </form>
                                                        </fieldset>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </td>
                                    <!-- END item [BATTERY] -->

                                </tr>
                                <table id="dynamic-gauges"></table>
                                <script>
                                    generateUI();
                                </script>
                            </table>
                        </div><!-- outer table -->
                    </div>
                </div>
                <br>
                <!-- End Dash -->
            </div>
            <!-- main div -->
            <!--/* ************************************************ EngineData ******** */-->
            <div id="engTab" align="center" hidden>
                <fieldset id="engtb" class="hide">
                    <legend class="btn tab" onclick='sH("EngineData")'>Engine Data</legend>
                    <div id="EngineData" title="Engine Stats" name="EngineData" class="data" align="center">
                        Engine Information.
                    </div>
                </fieldset>
                <br />
                <br />
            </div>
            <!-- Trans div -->
            <!--/* ************************************************ TransData ******** */-->
            <div id="TransTab" align="center" hidden>
                <fieldset id="trms" class="hide">
                    <legend class="btn tab" onclick='sH("TransData")'>Transmission Data</legend>
                    <div id="TransData" title="Engine Stats" name="TransData" class="data" align="center">
                        Automatic Transmission Information.
                    </div>
                </fieldset>
                <br />
                <br />
            </div>
            <!-- Trans div -->
            <!--/* ************************************************ Diagnostic Trouble Codes ****** */-->

            <div id="MilTab" align="center" hidden>
                <fieldset id="dtc" class="hide">
                    <legend onclick='sH("dtcdata")'
                            style="cursor:default;width:auto;margin:0 auto;padding:0 60px;border-radius:2px;border-start-start-radius:20px;border-start-end-radius:20px;">
                        Diagnostic Trouble Codes
                        &nbsp;&nbsp;&nbsp; &nbsp;
                        <button id="resetMilBtn" onclick="sendEcmCmd(ECM.EcmCmdNums.resetMilCmdNum)" class="btn resBtn" disabled>
                            Reset MIL Codes
                        </button>
                    </legend>
                    <div name="dtcdata" id="dtcdata" title="Diagnostic Trouble Codes" class="data" align="center">
                        MIL CODES
                    </div>
                </fieldset>
                <br />
                <br />
            </div><!-- END [MIL] Tab -->
            <!--/* ************************************************ Actuators ****** */-->
            <div id="ActTab" align="center" hidden>
                <form id="actControls">
                    <div width="100%">
                        <fieldset style="border:none;">
                            <legend id="shact" name="shact"
                                    onclick='document.getElementById("actuators").hidden=!document.getElementById("actuators").hidden'>
                                Actuators
                            </legend>
                        </fieldset>
                        <div align="center" id="actuators" class="tab" style="width:fit-content;padding:0;border-radius:10%;">
                            <div width="50%" align="center" class="hide">
                                <table width="98%">
                                    <tr align="center">
                                        <td width="22%">
                                            <div align="center">
                                                <table border="1" cellpadding="0" bgcolor="#efefef"
                                                       bordercolor="#c0c0c0" bordercolordark="#808080"
                                                       bordercolorlight="#ffffff">
                                                    <tr align="center">
                                                        <td>
                                                            <fieldset>
                                                                <legend>Reset All</legend>
                                                                <label for="resetall">Reset All</label>
                                                                <input type="radio" id="resetall"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.reset)"
                                                                       name="idle" value="resetall"><br>
                                                            </fieldset>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                        <td width="22%">
                                            <div align="center">
                                                <table border="1" cellpadding="0" bgcolor="#efefef"
                                                       bordercolor="#c0c0c0" bordercolordark="#808080"
                                                       bordercolorlight="#ffffff">
                                                    <tr align="center">
                                                        <td>
                                                            <fieldset>
                                                                <legend>Coolant Fan</legend>
                                                                <label for="fanon">fan on</label>
                                                                <input type="radio" id="fanon"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.fanon)"
                                                                       name="idle" value="fanon"><br>
                                                                <label for="fanoff">fan off</label>
                                                                <input type="radio" id="fanoff"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.fanoff)"
                                                                       name="idle" value="fanoff"><br>
                                                            </fieldset>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                        <td width="22%">
                                            <div align="center">
                                                <table border="1" cellpadding="0" bgcolor="#efefef"
                                                       bordercolor="#c0c0c0" bordercolordark="#808080"
                                                       bordercolorlight="#ffffff">
                                                    <tr align="center">
                                                        <td>
                                                            <fieldset>
                                                                <legend>MIL/SES</legend>
                                                                <label for="lighton">Light On</label>
                                                                <input type="radio" id="lighton"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.milon)"
                                                                       name="idle" value="lighton"><br>
                                                                <label for="lightoff">Light Off</label>
                                                                <input type="radio" id="lightoff"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.miloff)"
                                                                       name="idle" value="lightoff"><br>
                                                            </fieldset>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                    </tr>


                                    <tr align="center">
                                        <td width="22%">
                                            <div>
                                                <table border="1" cellpadding="0" bgcolor="#efefef"
                                                       bordercolor="#c0c0c0" bordercolordark="#808080"
                                                       bordercolorlight="#ffffff">
                                                    <tr align="center">
                                                        <td>
                                                            <fieldset>
                                                                <legend>Idle Speed</legend>
                                                                <label for="idle6">600</label>
                                                                <input type="radio" id="idle6"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.idle6)"
                                                                       name="idle" value="6"><br>
                                                                <label for="idle8">800</label>
                                                                <input type="radio" id="idle8"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.idle8)"
                                                                       name="idle" value="8"><br>
                                                                <label for="idle10">1000</label>
                                                                <input type="radio" id="idle10"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.idle10)"
                                                                       name="idle" value="10"><br>
                                                                <label for="idle12">1200</label>
                                                                <input type="radio" id="idle12"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.idle12)"
                                                                       name="idle" value="12"><br>
                                                            </fieldset>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                        <td width="22%">
                                            <div align="center">
                                                <table border="1" cellpadding="0" bgcolor="#efefef"
                                                       bordercolor="#c0c0c0" bordercolordark="#808080"
                                                       bordercolorlight="#ffffff">
                                                    <tr align="center">
                                                        <td>
                                                            <fieldset>
                                                                <legend>EVAP Purge</legend>
                                                                <label for="evapon">EVAP Purge On</label>
                                                                <input type="radio" id="evapon"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.evapon)"
                                                                       name="idle" value="evapon"><br>
                                                                <label for="evapoff">EVAP Purge Off</label>
                                                                <input type="radio" id="evapoff"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.evapoff)"
                                                                       name="idle" value="evapoff"><br>
                                                            </fieldset>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                        <td width="22%">
                                            <div align="center">
                                                <table border="1" cellpadding="0" bgcolor="#efefef"
                                                       bordercolor="#c0c0c0" bordercolordark="#808080"
                                                       bordercolorlight="#ffffff">
                                                    <tr align="center">
                                                        <td>
                                                            <fieldset>
                                                                <legend>A/C Relay</legend>
                                                                <label for="acon">A/C On</label>
                                                                <input type="radio" id="acon"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.acon)"
                                                                       name="idle" value="acon"><br>
                                                                <label for="acoff">A/C Off</label>
                                                                <input type="radio" id="acoff"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.acoff)"
                                                                       name="idle" value="acoff"><br>
                                                            </fieldset>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                    </tr>

                                    <tr align="center">
                                        <td width="22%">
                                            <div align="center">
                                                <table border="1" cellpadding="0" bgcolor="#efefef"
                                                       bordercolor="#c0c0c0" bordercolordark="#808080"
                                                       bordercolorlight="#ffffff">
                                                    <tr align="center">
                                                        <td>
                                                            <fieldset>
                                                                <legend>EGR Solenoid 1</legend>
                                                                <!--<form>-->
                                                                <label for="egr1on">EGR solenoid On</label>
                                                                <input type="radio" id="egr1on"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.egr1on)"
                                                                       name="idle" value="egr1on"><br>
                                                                <label for="egr1off">EGR solenoid Off</label>
                                                                <input type="radio" id="egr1off"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.egr1off)"
                                                                       name="idle" value="egr1off"><br>
                                                                <!--</form>-->
                                                            </fieldset>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                        <td width="22%">
                                            <div align="center">
                                                <table border="1" cellpadding="0" bgcolor="#efefef"
                                                       bordercolor="#c0c0c0" bordercolordark="#808080"
                                                       bordercolorlight="#ffffff">
                                                    <tr align="center">
                                                        <td>
                                                            <fieldset>
                                                                <legend>EGR Solenoid 2</legend>
                                                                <!--<form>-->
                                                                <label for="egr2on">EGR solenoid On</label>
                                                                <input type="radio" id="egr2on"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.egr2on)"
                                                                       name="idle" value="egr2on"><br>
                                                                <label for="egr2off">EGR solenoid Off</label>
                                                                <input type="radio" id="egr2off"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.egr2off)"
                                                                       name="idle" value="egr2off"><br>
                                                                <!--</form>-->
                                                            </fieldset>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                        <td width="22%">
                                            <div align="center">
                                                <table border="1" cellpadding="0" bgcolor="#efefef"
                                                       bordercolor="#c0c0c0" bordercolordark="#808080"
                                                       bordercolorlight="#ffffff">
                                                    <tr align="center">
                                                        <td>
                                                            <fieldset>
                                                                <legend>EGR Solenoid 3</legend>
                                                                <label for="egr3on">EGR solenoid On</label>
                                                                <input type="radio" id="egr3on"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.egr3on)"
                                                                       name="idle" value="egr3on"><br>
                                                                <label for="egr3off">EGR solenoid Off</label>
                                                                <input type="radio" id="egr3off"
                                                                       onclick="sendEcmCmd(ECM.EcmCmdNums.egr3off)"
                                                                       name="idle" value="egr3off"><br>
                                                            </fieldset>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div><!-- 1/2 td -->
                        </div>
                    </div>
                    <!-- 100% outer table -->
                </form>
                <br />
                <br />
            </div>
            <!--End Actuators-->
            <div id="ScanTab" align="center" hidden>
                <fieldset id="scanData" class="hide">
                    <legend class="btn tab" onclick='sH("sdata")'>{Raw} Scan Data</legend>
                    <div name="sdata" id="sdata" title="serial data" align="center"></div>
                </fieldset>
                <br />
                <br />
            </div>
            <br>
            <div align="right" style="width:98%;border:none;padding:0;margin:-50px 0 0 0;height:0">
                <img title="1995 Camaro" alt="1995 Camaro" src="img/camaro1.png"
                     style="margin-left:-108px;float:right;border:none;height:48px;width:100px;" />
            </div>
        </div>
        <!-- footer -->
        <hr size="3">
        <table width="95%" align="center">
            <tr>
                <td class="hide">
                    <!-- Copyright -->
                    <script>
                        function yrTitle() {
                            const d = new Date(); return '&#169;' + d.getFullYear() + '&#8482;T&#169;ReMeTaL v: ' + APPVERSION;
                        }
                        function yr() {
                            const d = new Date(); return '&#169;' + d.getFullYear() + '&#8482;T&#169;ReMeTaL <sub> v: ' + APPVERSION + '</sub>';
                        }
                        document.write('<small onclick=window.open("https://toremetal.com") style="color:#752929;text-align: left;position: fixed;z-index:8; bottom: 6px; left: 5px;cursor: pointer;line-height: 0;display:block !important;" title="COPYRIGHT ' + yrTitle() + '" >' + yr() + "</small>");
                    </script>
                    <!-- End Copyright -->
                </td>
            </tr>
        </table><!-- end footer -->
        <script>
            const egrOne = document.getElementById("egr1");
            const egrTwo = document.getElementById("egr2");
            const egrThree = document.getElementById("egr3");

            function egrStatus(egr, color) {
                switch (egr) {
                    case 0:
                        egrOne.style = "background-color:" + color + ";";
                        break;
                    case 1:
                        egrTwo.style = "background-color:" + color + ";";
                        break;
                    case 2:
                        egrThree.style = "background-color:" + color + ";";
                        break;
                    default:
                }
            }
            egrStatus(0, "red");
            egrStatus(1, "red");
            egrStatus(2, "red");

            const sColors = document.getElementById("serialStatus");
            //sColors.style = "background-color:green;";
            function statChg(color) {
                sColors.style = "background-color:" + color + ";";
            }

            //var COOKIE_PERMISSION = false;
            var myIntervalReader;

            /* byte CACHE ARRAY[]'s
             * note: array handling methods
             * .pop(); :remove last item.
             * .slice(70, 70) :remove specific item.
             * .shift(); remove first item. */
            const EcmStream = [];
            //const engineDataBuffer = [];
            //var engineDataResponse;
            //var milDataResponse;
            //var vinDataResponse;
            //var engCheckSum;

            const DEBUG = false;
            
            //const ECM = new ECM278();
            
            const CMD_CONTROL = {
                lastCmd: ECM.EcmCmdNums.noCmdNum,
                nextCmd: ECM.EcmCmdNums.vinDataCmdNum,
                sendCmd: ECM.EcmCmdNums.stopComCmdNum,
                bufferSize: ECM.COM_PORT.bufferSize, // 76,
                loopTime: 8, /* 64 */
                delayTime: 9, /* x Loop time = milliseconds waited (no response) before resending last cmd */
                delayBytes: 128, /* bytes read (no response) before resending last cmd */
                cacheSize: 512, /* max number of bytes stored for processing */
                sendCnt: 0,
                loopCount: 0,
                readCount: 0,
                resetDelay: 0,
                firstrun: true,
                proceed: true, /* Force Serial Write to wait for Serial Read to finish before sending the next CMD. */
                com: 0,
                dCom: 0,
                vin: 0,
                mil: 0,
                eng: 0,
                msgSendCnt: 0,
                msg: 0, /* PCM msg delivery scheduler. */
                appTest: false // true :send responses.
            };

            if (window.location.search == "?test") { CMD_CONTROL.appTest = true; }

            document.getElementById("loopTimeValue").value = CMD_CONTROL.loopTime;
            document.getElementById("delayTime").value = CMD_CONTROL.delayTime;
            document.getElementById("delayBytes").value = CMD_CONTROL.delayBytes;
            document.getElementById("cacheSize").value = CMD_CONTROL.cacheSize;
            
            function setEcmValues() {
                CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                CMD_CONTROL.nextCmd = ECM.EcmCmdNums.vinDataCmdNum;
                CMD_CONTROL.sendCmd = ECM.EcmCmdNums.stopComCmdNum;
                CMD_CONTROL.bufferSize=ECM.COM_PORT.bufferSize;
                document.getElementById("bufferSize").value = CMD_CONTROL.bufferSize;
                document.getElementById("transmissionType").value = ECM.A_TRANSMISSION;
                setTransType(ECM.A_TRANSMISSION);
                document.getElementById("Mode4").hidden = ECM.hasNoVinData();
                document.getElementById("Mode4Label").hidden = ECM.hasNoVinData();
                if (ECM.hasNoVinData()) {
                    CMD_CONTROL.nextCmd = ECM.EcmCmdNums.engineDataCmdNum;
                }
            }
            
            /* Transmission Shift Type Controller */
            function setTransType(transVal) {
                ECM.A_TRANSMISSION = transVal;//!ECM.A_TRANSMISSION;
                document.getElementById("clutchdiv").hidden = ECM.A_TRANSMISSION;
                document.getElementById("tcc").hidden = !ECM.A_TRANSMISSION;
                document.getElementById("autoF").hidden = !ECM.A_TRANSMISSION;
                document.getElementById("autoTranTemp").hidden = !ECM.A_TRANSMISSION;
                //document.getElementById("fantd").hidden = !document.getElementById("fantd").hidden;
                document.getElementById("tranTabBtn").hidden = !ECM.A_TRANSMISSION;
            }

            setEcmValues();
            
            async function readSerialData(value) {
                let y = 0;
                //console.log(value);
                for (let x in value) {
                    try {
                        if ((CMD_CONTROL.lastCmd == ECM.EcmCmdNums.engineDataCmdNum) && (CMD_CONTROL.eng == 0) && (y + ECM.engDataLength < value.length) && msgTest(value[x], value[y + 1], value[y + 2], ECM.EcmCmdEngineDataStream)) {
                            CMD_CONTROL.eng = 1;/* Required here for Scans "if (msg)" Process! Prevents overlap before the process completes. */
                            if (DEBUG === 2) { console.log("[ENGINE-DATA]-RECEIVED"); }
                            //let results = value.slice(parseInt(y), parseInt(y + 71));
                            //let engDataResponse = results.slice(0, 70);
                            //let engCheckSum = results[70];
                            //let engData = results.slice(3, 70);

                            let engDataResponse = value.slice(parseInt(y), parseInt(y + ECM.engDataLength));
                            let engCheckSum = value[parseInt(y + ECM.engDataLength)];
                            let engData = value.slice(parseInt(y + 3), parseInt(y + ECM.engDataLength));

                            await checkSumTest(engDataResponse, engCheckSum).then((good) => {
                                if (good) {
                                    readEngine(ECM.ENGINE_DATA, engData).then(() => {
                                        if (CMD_CONTROL.firstrun) {
                                            sendEcmCmd(ECM.EcmCmdNums.milDataCmdNum);
                                            CMD_CONTROL.proceed = true;
                                        } else {
                                            CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                                            cmdRunning(0);
                                            CMD_CONTROL.proceed = true;
                                        }
                                    });
                                } else {
                                    sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum);
                                    CMD_CONTROL.proceed = true;
                                }
                            });

                            /*let checkSumTest = checkSum(engineDataResponse) === engCheckSum;
                            if (checkSumTest || !document.getElementById("validate").checked) {
                                if (checkSumTest) {console.log("✓-CHECKSUM:ENG");} else {console.log("✖-CHECKSUM:ENG");}
                                engineDataResponse.shift();
                                engineDataResponse.shift();
                                engineDataResponse.shift();
                                await readEngine(ECM.ENGINE_DATA, engineDataResponse).then(() => {
                                if (CMD_CONTROL.firstrun) {
                                    sendEcmCmd(ECM.EcmCmdNums.milDataCmdNum);
                                } else {
                                    CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                                    cmdRunning(0);
                                }
                                    CMD_CONTROL.proceed = true;
                                });
                            } else {
                                console.log("✖-CHECKSUM:ENG");
                                sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum);
                                CMD_CONTROL.proceed = true;
                            }*/

                            /* engineDataResponse = value.slice(parseInt(y), parseInt(y + 70));
                            engCheckSum = value[parseInt(y + 70)];
                            await checkSumTest(engineDataResponse, engCheckSum).then((good) => {
                                if (good) {
                                    engineDataResponse.shift();
                                    engineDataResponse.shift();
                                    engineDataResponse.shift();
                                    readEngine(ECM.ENGINE_DATA, engineDataResponse).then(() => {
                                        if (CMD_CONTROL.firstrun) {
                                            sendEcmCmd(ECM.EcmCmdNums.milDataCmdNum);
                                            CMD_CONTROL.proceed = true;
                                        } else {
                                            CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                                            cmdRunning(0);
                                            CMD_CONTROL.proceed = true;
                                        }
                                    });
                                } else {
                                    sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum);
                                    CMD_CONTROL.proceed = true;
                                }
                            });*/
                            break;
                        } else if ((CMD_CONTROL.lastCmd == ECM.EcmCmdNums.disconnectEcmCmdNum) && (CMD_CONTROL.dCom == 0) && (y + 3 < value.length) && msgTest(value[x], value[y + 1], value[y + 2], ECM.EcmCmdDisConnectDataStream)) {
                            CMD_CONTROL.dCom = 1;/* Prevents overlap before the process completes. */
                            document.getElementById("connected").checked = false;
                            console.log("ECM: Dis-Connected!");
                            CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                            statChg("#00000000;");
                            CMD_CONTROL.proceed = true;
                            break;
                        } else if ((CMD_CONTROL.lastCmd == ECM.EcmCmdNums.stopComCmdNum) && (CMD_CONTROL.com == 0) && (y + 3 < value.length) && msgTest(value[x], value[y + 1], value[y + 2], ECM.EcmCmdStopComDataStream)) {
                            if (CMD_CONTROL.sendCnt < 3) {
                                CMD_CONTROL.sendCnt++;
                                sendEcmCmd(ECM.EcmCmdNums.stopComCmdNum);
                                console.log("[STOPCOM]", CMD_CONTROL.sendCnt);
                                CMD_CONTROL.proceed = true;
                            } else {
                                CMD_CONTROL.com = 1;
                                console.log("[ECM-CONNECTED]");
                                document.getElementById("connected").checked = true;
                                CMD_CONTROL.sendCnt = 0;
                                sendEcmCmd(CMD_CONTROL.nextCmd);
                                CMD_CONTROL.proceed = true;
                                break;
                            }
                        } else if ((CMD_CONTROL.lastCmd == ECM.EcmCmdNums.vinDataCmdNum) && (CMD_CONTROL.vin == 0) && (parseInt(y + ECM.vinDataLength) < value.length) && msgTest(value[x], value[y + 1], value[y + 2], ECM.EcmCmdVinDataStream)) {
                            CMD_CONTROL.vin = 1;
                            if (DEBUG === 2) { console.log("[VIN-DATA]-RECEIVED"); }
                            //let results = value.slice(parseInt(y), parseInt(y + 49));
                            let vinDataResponse = value.slice(parseInt(y), parseInt(y + ECM.vinDataLength));// results.slice(0, 48);
                            let vinCheckSum = value[parseInt(y + ECM.vinDataLength)];// results[48];
                            let vinData = value.slice(parseInt(y + 3), parseInt(y + 21));//results.slice(3, 21);
                            
                            //let vinData = value.slice(parseInt(y+3), parseInt(y + 21));
                            //let vinCheckSum = value[parseInt(y+48)];
                            //let vinDataResponse = value.slice(parseInt(y), parseInt(y+48));

                            let checkSumsTest = checkSum(vinDataResponse) == vinCheckSum;
                            if (checkSumsTest) {
                                console.log("✓-CHECKSUM:VIN");
                                if (CMD_CONTROL.firstrun) {
                                    sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum);
                                } else {
                                    CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                                    cmdRunning(0);
                                }
                                await readVIN(vinDataResponse).then(() => {
                                    CMD_CONTROL.proceed = true;
                                });
                            } else {
                                console.log("✖-CHECKSUM:VIN");
                                sendEcmCmd(ECM.EcmCmdNums.vinDataCmdNum);
                                CMD_CONTROL.proceed = true;
                            }
                            break;
                        } else if ((CMD_CONTROL.lastCmd == ECM.EcmCmdNums.milDataCmdNum) && (CMD_CONTROL.mil == 0) && (y + ECM.milDataLength < value.length) && msgTest(value[x], value[y + 1], value[y + 2], ECM.EcmCmdMilDataStream)) {
                            CMD_CONTROL.mil = 1;
                            if (DEBUG === 2) { console.log("[MIL-DATA]-RECEIVED"); }
                            //let results = value.slice(parseInt(y), parseInt(y + 25));
                            let milDataResponse = value.slice(parseInt(y), parseInt(y + ECM.milDataLength));// results.slice(0, 24);
                            let milCheckSum = value[parseInt(y + ECM.milDataLength)];// results[24];
                            let milData = value.slice(parseInt(y + 3), parseInt(y + ECM.milDataLength));//results.slice(3, 24);

                            //let milData = value.slice(parseInt(y+3), parseInt(y+24));
                            //let milDataResponse = value.slice(parseInt(y), parseInt(y+24));
                            //let milCheckSum = value[y + 24];//.toString()

                            let checkSumsTest = checkSum(milDataResponse) == milCheckSum;
                            if (checkSumsTest) {
                                console.log("✓-CHECKSUM:MIL");
                                if (CMD_CONTROL.firstrun) { CMD_CONTROL.firstrun = false; }
                                CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                                cmdRunning(0);
                                await readMIL(milData).then(() => {
                                    CMD_CONTROL.proceed = true;
                                });
                            } else {
                                console.log("✖-CHECKSUM:MIL");
                                sendEcmCmd(ECM.EcmCmdNums.milDataCmdNum);
                                CMD_CONTROL.proceed = true;
                            }
                            break;
                        } else { CMD_CONTROL.proceed = true; }
                    } catch (error) {
                        console.error("readSerialData(" + y + "):", error);
                    }
                    y++;
                }
                /*if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.engineDataCmdNum && engineDataResponse.length > 0) {
                    await checkSumTest(engineDataResponse, engCheckSum).then((good) => {
                        if (good) {
                            engineDataResponse.shift();
                            engineDataResponse.shift();
                            engineDataResponse.shift();
                            readEngine(ECM.ENGINE_DATA, engineDataResponse).then(() => {
                                engineDataResponse=[];
                                if (CMD_CONTROL.firstrun) {
                                    sendEcmCmd(ECM.EcmCmdNums.milDataCmdNum);
                                    CMD_CONTROL.proceed = true;
                                } else {
                                    CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                                    cmdRunning(0);
                                    CMD_CONTROL.proceed = true;
                                }
                            });
                        } else {
                            sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum);
                            CMD_CONTROL.proceed = true;
                        }
                    });
                } else*/
                if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.reset) {
                    sendEcmCmd(ECM.EcmCmdNums.reset2);
                    CMD_CONTROL.proceed = true;
                } else if (CMD_CONTROL.lastCmd > ECM.EcmCmdNums.disconnectEcmCmdNum && CMD_CONTROL.lastCmd < ECM.EcmCmdNums.noCmdNum) {
                    sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum);
                    CMD_CONTROL.proceed = true;
                } else if (CMD_CONTROL.lastCmd >= ECM.EcmCmdNums.msg1 && CMD_CONTROL.lastCmd <= ECM.EcmCmdNums.msg3) {
                    /* (idea) if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.msg1) {sendEcmCmd(ECM.EcmCmdNums.msg2);} else if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.msg2) {sendEcmCmd(ECM.EcmCmdNums.msg3);}*/
                    CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                    CMD_CONTROL.proceed = true;
                } else { CMD_CONTROL.proceed = true; }

                /* retry after x number of bytes read */
                if (EcmStream.length > CMD_CONTROL.delayBytes) {
                    if (CMD_CONTROL.lastCmd < ECM.EcmCmdNums.msg1) {
                        document.getElementById("sendingEcmCmd").checked = true;
                        CMD_CONTROL.proceed = true;
                    }
                }
                /* Max cache size clear and resend if cmd-active */
                if (EcmStream.length > CMD_CONTROL.cacheSize) {
                    EcmStream.length = 0;
                    /*if (CMD_CONTROL.lastCmd < ECM.EcmCmdNums.msg1) {document.getElementById("sendingEcmCmd").checked = true;CMD_CONTROL.proceed = true;}*/
                }
            }

            const serialStreamHandler = new WritableStream({
                write(value) {
                    CMD_CONTROL.proceed = false;
                    statChg("blue");
                    let curData = document.getElementById("sdata").innerHTML;
                    let conbit = "";
                    for (let x in value) {
                        try {
                            //if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.engineDataCmdNum && engineDataBuffer.length > 0 && engineDataBuffer.length < 76) {engineDataBuffer.push(value[x]);}
                            //if (value[x]==228 && CMD_CONTROL.lastCmd === ECM.EcmCmdNums.engineDataCmdNum && engineDataBuffer.length === 0) {engineDataBuffer.push(value[x]);}//, 153, 1,
                            //if (EcmStream.length > 0) {EcmStream.push(value[x]);}
                            //if (EcmStream.length === 0 && value[x]==228) {EcmStream.push(value[x]);}
                            EcmStream.push(value[x]);
                            conbit += ECM_MAN.numericToAlpha(value[x]);
                            conbit += ",";
                        } catch (error) {
                            console.error("Byte:" + value[x], error);
                        }
                    }
                    try {
                        document.getElementById("sdata").innerHTML = CMD_CONTROL.readCount.toString() + ":" + conbit + "</br>" + curData;
                    } catch (error) {
                        console.error("(Raw)Writer:", error);
                    }
                    CMD_CONTROL.readCount++;
                    try {
                        if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.engineDataCmdNum && EcmStream.length >= 76) {// && engineDataBuffer.length === 76) {
                            readSerialData(EcmStream);//engineDataBuffer);
                        } else if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.disconnectEcmCmdNum && EcmStream.length >= 4) {
                            readSerialData(EcmStream);
                        } else if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.stopComCmdNum && EcmStream.length >= 16) {
                            readSerialData(EcmStream);
                        } else if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.vinDataCmdNum && EcmStream.length >= 54) {
                            readSerialData(EcmStream);
                        } else if (CMD_CONTROL.lastCmd === ECM.EcmCmdNums.milDataCmdNum && EcmStream.length >= 30) {
                            readSerialData(EcmStream);
                        } else {
                            readSerialData(EcmStream);
                        }
                        //readSerialData(EcmStream);
                    } catch (error) { console.error("(Serial):", error); }
                    //statChg("#00000000;");
                }
            });

            async function writeData(myport) {
                statChg("red");
                const writer = myport.writable.getWriter();
                try {
                    CMD_CONTROL.loopCount = 0;
                    if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.engineDataCmdNum) {/*engineDataBuffer.length=0;*/CMD_CONTROL.eng = 0; }
                    if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.milDataCmdNum) { CMD_CONTROL.mil = 0; }
                    if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.vinDataCmdNum) { CMD_CONTROL.vin = 0; }
                    if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.disconnectEcmCmdNum) { CMD_CONTROL.dCom = 0; }
                    if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.stopComCmdNum) { CMD_CONTROL.com = 0; }
                    CMD_CONTROL.lastCmd = CMD_CONTROL.sendCmd;
                    //if (CMD_CONTROL.proceed && EcmStream.length > 152) {
                    EcmStream.length = 0;
                    //}
                    document.getElementById("wait").innerHTML = "SENDING CMD[" + ECM.CMDNAMES[CMD_CONTROL.sendCmd] + "]<br/>Please Wait";
                    console.log("SEND CMD[" + ECM.CMDNAMES[CMD_CONTROL.sendCmd] + "]");
                    await writer.write(ECM.EcmCmds[ECM.CMDNAMES[CMD_CONTROL.sendCmd]]).then(() => {
                        if (CMD_CONTROL.appTest) {
                            if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.stopComCmdNum) {
                                try {
                                    writer.write(ECM.EcmCmds[ECM.CMDNAMES[ECM.EcmCmdNums.stopComCmdNum]]);
                                    console.log("SEND CMD[" + ECM.CMDNAMES[ECM.EcmCmdNums.stopComCmdNum] + "]");
                                } catch (e) {
                                    console.error("stopcom", e);
                                }
                            } else if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.engineDataCmdNum) {
                                try {
                                    writer.write(ECM.EcmCmds[ECM.CMDNAMES[ECM.EcmCmdNums.engTest]]);
                                    console.log("SEND CMD[" + ECM.CMDNAMES[ECM.EcmCmdNums.engTest] + "]");
                                } catch (e) {
                                    console.error("engTest", e);
                                }
                            } else if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.vinDataCmdNum) {
                                try {
                                    writer.write(ECM.EcmCmds[ECM.CMDNAMES[ECM.EcmCmdNums.vinTest]]);
                                    console.log("SEND CMD[" + ECM.CMDNAMES[ECM.EcmCmdNums.vinTest] + "]");
                                } catch (e) {
                                    console.error("vinTest", e);
                                }
                            } else if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.milDataCmdNum) {
                                try {
                                    writer.write(ECM.EcmCmds[ECM.CMDNAMES[ECM.EcmCmdNums.milTest]]);
                                    console.log("SEND CMD[" + ECM.CMDNAMES[ECM.EcmCmdNums.milTest] + "]");
                                } catch (e) {
                                    console.error("milTest", e);
                                }
                            }/* else if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.msg1) {
                                                try {
                                                    writer.write(ECM.EcmCmds[ECM.CMDNAMES[ECM.EcmCmdNums.msg1]]);
                                                    console.log("SEND CMD[" + ECM.CMDNAMES[ECM.EcmCmdNums.msg1] + "]");
                                                } catch (e) {
                                                    console.error("msg1", e);
                                                }
                                            } else if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.msg2) {
                                                try {
                                                    writer.write(ECM.EcmCmds[ECM.CMDNAMES[ECM.EcmCmdNums.msg2]]);
                                                    console.log("SEND CMD[" + ECM.CMDNAMES[ECM.EcmCmdNums.msg2] + "]");
                                                } catch (e) {
                                                    console.error("msg2", e);
                                                }
                                            } else if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.msg3) {
                                                try {
                                                    writer.write(ECM.EcmCmds[ECM.CMDNAMES[ECM.EcmCmdNums.msg3]]);
                                                    console.log("SEND CMD[" + ECM.CMDNAMES[ECM.EcmCmdNums.msg3] + "]");
                                                } catch (e) {
                                                    console.error("msg3", e);
                                                }
                                            }*/
                        }
                    });/*.then((v) => {
                                        if (CMD_CONTROL.sendCmd === ECM.EcmCmdNums.stopComCmdNum) {
                                            try {
                                                writer.write(ECM.EcmCmds[ECM.CMDNAMES[CMD_CONTROL.sendCmd]]);
                                                console.log("SEND CMD[" + ECM.CMDNAMES[CMD_CONTROL.sendCmd] + "]");
                                            } catch (e) {
                                                console.error("stopcom", e);
                                            }
                                        }
                                    });*/
                    await writer.releaseLock();
                    document.getElementById("sendingEcmCmd").checked = false;
                    //statChg("#00000000;");
                } catch (error) {
                    console.error("writeData():", error);
                    await writer.releaseLock();
                } finally {
                    statChg("#00000000;");
                }
            }

            async function getSerialPortInfo() {
                try {
                    const myport = await navigator.serial.requestPort();
                    await myport.open({ baudRate: ECM.COM_PORT.baudRate, dataBits: ECM.COM_PORT.dataBits, stopBits: ECM.COM_PORT.stopBits, parity: ECM.COM_PORT.parity, bufferSize: CMD_CONTROL.bufferSize });
                    const { usbProductId, usbVendorId } = myport.getInfo();
                    let portInfo = "[usbProductId:]" + usbProductId + " [usbVendorId:]" + usbVendorId + "<br />";
                    document.getElementById("sdata").innerHTML = portInfo;
                    document.getElementById("loopTimeValue").disabled = true;
                    document.getElementById("bufferSize").disabled = true;
                    document.getElementById("connect").disabled = true;
                    document.getElementById("ecmfile").disabled = true;
                    document.getElementById("wait").hidden = false;
                    cmdRunning(1);
                    document.getElementById("sendingEcmCmd").checked = true;

                    const reader = myport.readable.pipeTo(serialStreamHandler);

                    myIntervalReader = setInterval(function () {
                        if (CMD_CONTROL.proceed) {
                            CMD_CONTROL.loopCount++;
                            if (document.getElementById("sendingEcmCmd").checked) {
                                writeData(myport);
                            } else if (CMD_CONTROL.lastCmd < ECM.EcmCmdNums.msg1 && CMD_CONTROL.loopCount > CMD_CONTROL.delayTime) {
                                writeData(myport); /* time based retry. */
                            } else if (CMD_CONTROL.lastCmd == ECM.EcmCmdNums.noCmdNum && document.getElementById("scan").value == "On" && !CMD_CONTROL.firstrun) {
                                let autoMsg = !document.getElementById("msg").checked;
                                if (CMD_CONTROL.msg == 0) {
                                    CMD_CONTROL.msg = 1;
                                    CMD_CONTROL.nextCmd = ECM.EcmCmdNums.engineDataCmdNum;
                                    CMD_CONTROL.sendCnt = 0;
                                    sendEcmCmd(ECM.EcmCmdNums.stopComCmdNum);
                                } else if (CMD_CONTROL.msg == 1 && CMD_CONTROL.eng == 1) {
                                    if (CMD_CONTROL.msgSendCnt < 2) {
                                        CMD_CONTROL.msgSendCnt++;
                                    } else {
                                        CMD_CONTROL.msgSendCnt = 0;
                                        CMD_CONTROL.msg = 2;
                                        if (autoMsg) { sendEcmCmd(ECM.EcmCmdNums.msg1); } else { sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum); }
                                    }
                                } else if (CMD_CONTROL.msg == 2) {
                                    if (CMD_CONTROL.msgSendCnt < 2) {
                                        CMD_CONTROL.msgSendCnt++;
                                    } else {
                                        CMD_CONTROL.msgSendCnt = 0;
                                        CMD_CONTROL.msg = 3;
                                        if (autoMsg) { sendEcmCmd(ECM.EcmCmdNums.msg2); } else { sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum); }
                                    }
                                } else if (CMD_CONTROL.msg == 3) {
                                    if (CMD_CONTROL.msgSendCnt < 2) {
                                        CMD_CONTROL.msgSendCnt++;
                                    } else {
                                        CMD_CONTROL.msgSendCnt = 0;
                                        CMD_CONTROL.msg = 4;
                                        if (autoMsg) { sendEcmCmd(ECM.EcmCmdNums.msg3); } else { sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum); }
                                    }
                                } else if (CMD_CONTROL.msg == 4) {
                                    if (CMD_CONTROL.msgSendCnt < 2) {
                                        CMD_CONTROL.msgSendCnt++;
                                    } else {
                                        CMD_CONTROL.msgSendCnt = 0;
                                        CMD_CONTROL.msg = 1;
                                        sendEcmCmd(ECM.EcmCmdNums.engineDataCmdNum);
                                    }
                                }
                            }
                            if (CMD_CONTROL.lastCmd >= ECM.EcmCmdNums.noCmdNum) { statChg("yellow"); }
                            if (document.getElementById("disconnect").disabled && CMD_CONTROL.firstrun == false) {
                                clearInterval(myIntervalReader);
                            }
                        }
                    }, CMD_CONTROL.loopTime);
                } catch (error) { console.error("getSerialPortInfo():", error); }
            }

            /* =====================================================|
             * [Send Requests to the ECM:] sendEcmCmd(cmdNum)
             *  Add new commands: <button onclick=sendEcmCmd(cmdNum)>
             *  const EcmCmd = {
             *      idle12:18,
             *      newCMD:NextNumber
             *  ....
             *  const EcmCmds = {
             *    ...,
             *    newCMD: new Uint8Array([value,value,value,value])
             * ------------------------------------------------- */
            function sendEcmCmd(cmdNum) {
                try {
                    CMD_CONTROL.sendCmd = cmdNum;
                    document.getElementById("sendingEcmCmd").checked = true;
                } catch (error) {
                    console.error("ERROR [sendEcmCmd(" + cmdNum.toString() + ")]: ", error);
                }
            }

            /* disconnectECM(): Stop Reading ECM Data. */
            function disconnectECM() {
                sendEcmCmd(ECM.EcmCmdNums.disconnectEcmCmdNum);
                document.getElementById("disconnect").disabled = true;
                document.getElementById("scan").disabled = true;
                document.getElementById("Mode1").disabled = true;
                document.getElementById("Mode2").disabled = true;
                document.getElementById("Mode4").disabled = true;
                document.getElementById("resetMilBtn").disabled = true;
                document.getElementById("resetBlmBtn").disabled = true;
                document.getElementById("actControls").hidden = true;
                document.getElementById("connected").checked = false;
            }

            /* startStopRealTime()-Sends Engine Data Requests. */
            function startStopRealTime() {
                if (document.getElementById("scan").value !== "On") {
                    document.getElementById("Mode1").disabled = true;
                    document.getElementById("Mode2").disabled = true;
                    document.getElementById("Mode4").disabled = true;
                    CMD_CONTROL.msg = 0;
                    document.getElementById("scan").value = "On";
                } else {
                    document.getElementById("Mode1").disabled = false;
                    document.getElementById("Mode2").disabled = false;
                    document.getElementById("Mode4").disabled = false;
                    document.getElementById("scan").value = "Rpt";
                    CMD_CONTROL.lastCmd = ECM.EcmCmdNums.noCmdNum;
                }
            }

            /* Scanning Indicator. */
            function cmdRunning(d) {
                if (d == 1) {
                    document.getElementById("Mode1").disabled = true;
                    document.getElementById("Mode4").disabled = true;
                    document.getElementById("Mode2").disabled = true;
                    document.getElementById("resetMilBtn").disabled = true;
                    document.getElementById("resetBlmBtn").disabled = true;
                    document.getElementById("scan").disabled = true;
                    document.getElementById("wait").hidden = false;
                } else {
                    if (document.getElementById("scan").value == "Rpt") {
                        document.getElementById("Mode1").disabled = false;
                        document.getElementById("Mode4").disabled = false;
                        document.getElementById("Mode2").disabled = false;
                    }
                    document.getElementById("resetMilBtn").disabled = false;
                    document.getElementById("resetBlmBtn").disabled = false;
                    document.getElementById("disconnect").disabled = false;
                    document.getElementById("scan").disabled = false;
                    document.getElementById("actControls").hidden = false;
                    document.getElementById("wait").hidden = true;
                }
            }

            /* Allows Modification of the stop-com & looping request cmd's,(sent to the serial port).*/
            function createCmd(e4) {
                if (e4 == "com") {
                    return new Uint8Array([document.getElementById("s0").value, document.getElementById("s1").value, document.getElementById("s2").value, document.getElementById("s3").value]);
                } else {
                    return new Uint8Array([document.getElementById("e0").value, document.getElementById("e1").value, document.getElementById("e2").value, document.getElementById("e3").value, document.getElementById("e4").value]);
                }
            }

            /* Function: msgTest(v,v,v,m) Compare serial data to request response message.*/
            function msgTest(v0, v1, v2, msg) {
                return v0.toString() + "," + v1.toString() + "," + v2.toString() === msg.id.toString() + "," + msg.messageLength.toString() + "," + msg.mode.toString();
            }

            /* show hide elements */
            function sH(id) {
                document.getElementById(id).hidden = !document.getElementById(id).hidden;
            }

            /* Set RPM-Guage Needle Position. */
            function rotateRPM() {
                let cRpm = parseInt(document.getElementById("rpm").value);
                if (cRpm > 10000) { cRpm = 10000; } else if (cRpm < 0) { cRpm = 0; }
                let r = (parseInt(cRpm) * 0.03).toString() + "deg";
                document.getElementById("rpm-needle").style.rotate = r;
            }

            /* Set MPH-Guage Needle Position. */
            function rotateMPH() {
                let cMph = parseInt(document.getElementById("mph").value);
                if (cMph > 105) { cMph = 105; } else if (cMph < 0) { cMph = 0; }
                let r = (parseInt(cMph) * 3).toString() + "deg";
                document.getElementById("mph-needle").style.rotate = r;
            }

            /* User Selected Info to View. */
            function selectTab(i) {
                document.getElementById("MainTab").hidden = true;
                document.getElementById("engTab").hidden = true;
                document.getElementById("TransTab").hidden = true;
                document.getElementById("ScanTab").hidden = true;
                document.getElementById("MilTab").hidden = true;
                document.getElementById("ActTab").hidden = true;
                document.getElementById(i).hidden = false;
            }

            /* full screen. */
            var elem = document.documentElement;
            function openFullscreen() {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) { /* Safari */
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) { /* IE11 */
                    elem.msRequestFullscreen();
                }
            }

            function closeFullscreen() {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) { /* Safari */
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { /* IE11 */
                    document.msExitFullscreen();
                }
            }

            function getFScreen() {
                if (document.fullscreenElement) {
                    closeFullscreen();
                } else {
                    openFullscreen();
                }
            } /* [END] full screen*/

            /* Transmission Gear Position Controller */
            const automatic = document.getElementById("gear");
            const automaticGear = document.getElementById("prndlDis");

            automatic.oninput = function () {
                setTransGear();
            }

            function setTransGear() {
                if (automatic.value == 0) {
                    automaticGear.innerHTML = "LOW";
                } else if (automatic.value == 1) {
                    automaticGear.innerHTML = "D2";
                } else if (automatic.value == 2) {
                    automaticGear.innerHTML = "D3";
                } else if (automatic.value == 3) {
                    automaticGear.innerHTML = "D4";
                } else if (automatic.value == 4) {
                    automaticGear.innerHTML = "N";
                } else if (automatic.value == 5) {
                    automaticGear.innerHTML = "R";
                } else if (automatic.value == 6) {
                    automaticGear.innerHTML = "P";
                } else {
                    automaticGear.innerHTML = "P";
                }
            } /* [END] Transmission Gear Position Controller */

            /* MIL/DTC DATA CHECKSUM TEST */
            function checkSum(data) {
                /*let sum = 0;
                for (let c in data) {
                    let nVal = (256 - parseInt(data[c]));
                    sum = sum + nVal;
                }
                return (sum % 256);*/ // dataCheckSum
                return ECM_MAN.getCheckSum(data);
            }

            /* ENGINE DATA CHECKSUM TEST */
            async function checkSumTest(data, checkSum) {
                /*let sum = 0;
                for (let c in data) {
                    let nVal = 256 - parseInt(data[c]);
                    sum = sum + nVal;
                }
                let dataCheckSum = sum % 256;
                let goodCheckSum = dataCheckSum == checkSum;*/
                let goodCheckSum = ECM_MAN.testCheckSum(data, checkSum);
                if (goodCheckSum) {
                    console.log("✓-CHECKSUM:ENG");
                } else {
                    console.log("✖-CHECKSUM:ENG");
                }
                if ((goodCheckSum == false) && document.getElementById("validate").checked) {
                    return false;
                }
                return true; // dataCheckSum === checkSum;
            }

            /* VIN SERIAL DATA HANDLER. */
            async function readVIN(vin) {
                document.getElementById("carVin").innerHTML = "vin: " + ECM.getVIN(vin);
                //let vinStr = "";
                /*for (let c in vin) {
                    vinStr += String.fromCharCode(vin[c]);
                }
                document.getElementById("carVin").innerHTML = "vin:" + vinStr;*/
                return "";//vinStr;
            }

            /* MIL/DTC SERIAL DATA HANDLER. */
            async function readMIL(dataStream) {
                document.getElementById("dtcdata").innerHTML = ECM.getMIL(dataStream, ECM.values);
                document.getElementById("actcodes").value = ECM.values.activeDTC;
            
                /*const value = dataStream;
                let dtcStr = "";
                for (let k = 0; k <= 20; k++) {
                    if (k == 0) {
                        document.getElementById("actcodes").value = value[k];
                    } else if (value[k] != 0) {
                        let dtcCode = ECM_MAN.numToBin(value[k]);
                        let tc = 7;
                        for (let t in dtcCode) {
                            try {
                                if (dtcCode[t] == "1") {
                                    let MilCode = ECM.DTCCODES["code" + (k + 1).toString() + tc.toString()];
                                    if (DEBUG) { console.log("byte[" + k + "]:" + dtcCode + " bit:" + tc.toString() + " [MilCode]" + MilCode); }
                                    if (MilCode != "") { dtcStr += MilCode + "<br/>"; }
                                }
                            } catch (error) {
                                console.error("ERROR (value[" + k + "]:" + value[k] + " dtcCode:" + dtcCode + ") " + " bit:" + tc, error);
                            }
                            tc--;
                        }
                    }
                }
                document.getElementById("dtcdata").innerHTML = dtcStr;*/
                return 0;
            } /* -- [End] function -- */
            
/* ENGINE SERIAL DATA HANDLER. */
async function readEngine(ecmFileConst, dataStream) {
    let BYTEID = Object.keys(ecmFileConst);
    let index = 0;
    for (let z in ecmFileConst) {
        //let index = parseInt(z);
        try {
            if (BYTEID[index] == "length") {
                document.getElementById("EngineData").innerHTML = ECM.values.engStr;
                document.getElementById("TransData").innerHTML = ECM.values.tranStr;
                document.getElementById("clutchpressed").checked = ECM.values.clutchEngaged;
                document.getElementById("brakepressed").checked = ECM.values.tccBrakeEngaged;
                document.getElementById("fanOnOff").checked = ECM.values.fanOn;
                //document.getElementById("acv").value = ECM.values.acVolts;
                rotateRPM();
                rotateMPH();
                setTransGear();
                if (ECM.values.EGR1) {egrStatus(0, "green");} else {egrStatus(0, "red");}
                if (ECM.values.EGR2) {egrStatus(1, "green");} else {egrStatus(1, "red");}
                if (ECM.values.EGR3) {egrStatus(2, "green");} else {egrStatus(2, "red");}
                if (ECM.values.clutchEngaged){
                    document.getElementById('clutchImg').style.transform = 'rotateZ(35deg)'
                } else {
                    document.getElementById('clutchImg').style.transform = 'rotateZ(0deg)'
                }
                if (parseInt(document.getElementById("milcodes").value) > 0) {
                //if ((parseInt(document.getElementById("milcodes").value) > 0) || (parseInt(document.getElementById("actcodes").value) > 0)) {
                    document.getElementById("checkEngineLight").src="img/checkEngineLight.png";
                } else {
                    document.getElementById("checkEngineLight").src="img/checkEngine.png";
                }
            } else if (index < ecmFileConst.length) {
                document.getElementById(ecmFileConst[z]).value = ECM.processEngData[index](dataStream[index], ECM.values);
            }
        } catch (error) {
            if (index < ecmFileConst.length) {console.error("ERROR setValues-ecmFileConst[" + index + "]:" + ecmFileConst[z] + " value[" + index + "]:" + dataStream[index], error);}
        }
        index++;
    }
    return 0;
} /* -- [End] function -- */

            /* // COOKIES
            function setCookie(cname, cvalue, exdays) {
                const d = new Date();
                d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                let expires = "expires=" + d.toUTCString();
                document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
            }

            function getCookie(cname) {
                let name = cname + "=";
                let decodedCookie = decodeURIComponent(document.cookie);
                let ca = decodedCookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') {
                        c = c.substring(1);
                    }
                    if (c.indexOf(name) === 0) {
                        return c.substring(name.length, c.length);
                    }
                }
                return "";
            }

            function checkCookie() {
                let allowCookies = getCookie("allowCookies");
                if (allowCookies === "" || allowCookies === null) {
                    allowCookies = confirm("Do You Give Permission to uses Cookies to Save Changes to Settings? [Permission & Cookies Saved for 30 days.]");
                    COOKIE_PERMISSION = allowCookies;
                    console.log("allowCookies:" + allowCookies);
                    setCookie("allowCookies", allowCookies, 30);
                } else if (allowCookies === true) {
                    COOKIE_PERMISSION = true;
                    let speed = getCookie("speed");
                    if (speed !== "" && speed !== null) {
                        document.getElementById("loopTimeValue").value = speed;
                        CMD_CONTROL.loopTime = speed;
                    }
                    let msgs = getCookie("msgs");
                    if (msgs !== "" && msgs !== null) {
                        document.getElementById("msg").checked = msgs;
                    }
                    let vchk = getCookie("vchk");
                    if (vchk !== "" && vchk !== null) {
                        document.getElementById("validate").checked = vchk;
                    }
                }
            }

            const loopTime = document.getElementById("loopTimeValue");
            loopTime.onchange = function () {
                if (COOKIE_PERMISSION) {setCookie("speed", loopTime.value, 30);}
            }

            const msgssnd = document.getElementById("msg");
            msgssnd.onchange = function () {
                if (COOKIE_PERMISSION) {setCookie("msgs", msgssnd.checked, 30);}
            }

            const vchksum = document.getElementById("validate");
            vchksum.onchange = function () {
                if (COOKIE_PERMISSION) {setCookie("vchk", vchksum.checked, 30);}
            }

            //[END] COOKIES */

        </script>
    </div>
</body>
</html>
